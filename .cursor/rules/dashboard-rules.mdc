---
description: Rules for development in the dashboard subdirectory
globs: client/dashboard/**
alwaysApply: false
---

You are an expert AI programming assistant specializing in the WordPress.com Dashboard. This subdirectory implements modern web application patterns with TypeScript, TanStack Query, and TanStack Router.

Use these rules on top of [calypso-client-rules.mdc](mdc:./rules/calypso-client-rules.mdc).

## Documentation

For detailed implementation guidance, refer to:
- [Data Library](mdc:client/dashboard/docs/data-library.md) - TanStack Query usage, loaders, caching
- [UI Components](mdc:client/dashboard/docs/ui-components.md) - WordPress components, placeholders, DataViews
- [Router](mdc:client/dashboard/docs/router.md) - TanStack Router patterns, lazy loading
- [Internationalization](mdc:client/dashboard/docs/i18n.md) - Translation patterns, CSS logical properties
- [Typography and Copy](mdc:client/dashboard/docs/typography-and-copy.md) - Capitalization, snackbar messages
- [Testing](mdc:client/dashboard/docs/testing.md) - Testing strategies

## Code Review Guidelines

When reviewing dashboard code, watch for these specific patterns and potential issues:

### External Link Handling

- All URLs linking to old WordPress.com/Calypso MUST use `wpcomLink()` function
	- **Import**: Use `import { wpcomLink } from '@automattic/dashboard/utils/link'`
	- **Purpose**: Ensures proper environment configuration (dev vs production hostnames)
- Every link to `/checkout` must have `redirect_to` and `cancel_to` query param
	- **Purpose**: Ensures correct behaviour when exiting the checkout screen
- Every link to `/setup/plan-upgrade` must have a `cancel_to` query param
	- **Purpose**: Ensures correct behaviour when exiting the upgrade screen

```typescript
// ✅ Correct - wrapped with wpcomLink()
<a href={ wpcomLink( '/me/security' ) }>Security Settings</a>

// ❌ Incorrect - hardcoded WordPress.com URL
<a href="https://wordpress.com/me/security">Security Settings</a>

// ❌ Incorrect - relative URL to old dashboard
<a href="/me/security">Security Settings</a>
```

### Mutation Callback Handling

- **Component-specific Callbacks**: Attach `onSuccess`/`onError` to the `mutate()` call, not `useMutation()`
- **Query Options**: Don't override callbacks defined in api-queries mutation options
- **Cache Updates**: Query option callbacks handle cache invalidation and updates

```typescript
// ✅ Correct - callback on mutate call
const { mutate: saveSetting } = useMutation( saveSettingMutation() );

const handleSave = () => {
  saveSetting( newValue, {
    onSuccess: () => {
      // Component-specific success handling
      setShowSuccessMessage( true );
    },
    onError: ( error ) => {
      // Component-specific error handling
      setError( error.message );
    },
  } );
};

// ❌ Incorrect - overrides query option callbacks
const { mutate: saveSetting } = useMutation( {
  ...saveSettingMutation(),
  onSuccess: () => setShowSuccessMessage( true ), // Breaks cache updates!
  onError: ( error ) => setError( error.message ),
} );
```

### Typography and Copy Compliance

- **Sentence Case**: Verify buttons, labels, and headings use sentence case (not title case)
- **Periods**: Check sentences end with periods; buttons and labels do not
- **Curly Quotes**: Ensure proper curly quotes (“like this”) and apostrophes (it’s) are used
- **Product Names**: "Hosting Dashboard" should be capitalized as proper noun
- **Snackbar Patterns**: Follow established patterns for success/error messages

```typescript
// ✅ Correct copy patterns
<Button>Save changes</Button>  // No period, sentence case
<p>Your settings have been saved.</p>  // Period, curly quotes if needed

// Snackbar messages
`SSH access enabled.`
`Failed to save PHP version.`

// ❌ Incorrect patterns  
<Button>Save Changes.</Button>  // Has period, title case
<p>Your settings have been saved</p>  // Missing period
`SSH Access Enabled`  // Title case, missing period
```

Remember: This dashboard represents modern React patterns. Prioritize performance, accessibility, and maintainability while leveraging the WordPress ecosystem.
